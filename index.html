<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zero: Neon Mobile Legend</title>
    <style>
        :root { --neon: #00f7ff; --pink: #ff0055; }
        body { margin: 0; background: #02020a; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; color: white; touch-action: none; }
        
        #game-container { position: relative; border: 2px solid var(--neon); box-shadow: 0 0 15px var(--neon); border-radius: 8px; overflow: hidden; }
        canvas { background: #050515; display: block; max-width: 100vw; max-height: 60vh; }

        #ui { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; font-weight: bold; pointer-events: none; text-shadow: 0 0 5px black; }
        .stat { background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--neon); }

        /* أزرار التحكم للهاتف */
        #mobile-controls { display: flex; width: 100%; max-width: 500px; justify-content: space-between; padding: 20px; box-sizing: border-box; }
        .btn-group { display: flex; gap: 10px; }
        .control-btn { width: 70px; height: 70px; background: rgba(255,255,255,0.1); border: 2px solid var(--neon); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--neon); -webkit-tap-highlight-color: transparent; font-weight: bold; }
        .control-btn:active { background: var(--neon); color: black; transform: scale(0.9); }
        #shoot-btn { border-color: var(--pink); color: var(--pink); }
        #shoot-btn:active { background: var(--pink); color: white; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="ui">
            <div class="stat">النقاط: <span id="score">0</span></div>
            <div class="stat" id="boss-info" style="display:none; border-color: var(--pink);">طاقة الزعيم: <span id="bossHealth">15</span></div>
            <div class="stat">المستوى: <span id="level">1</span></div>
        </div>
        <canvas id="gameCanvas" width="800" height="400"></canvas>
    </div>

    <div id="mobile-controls">
        <div class="btn-group">
            <div class="control-btn" id="left-btn">←</div>
            <div class="control-btn" id="right-btn">→</div>
        </div>
        <div class="btn-group">
            <div class="control-btn" id="jump-btn">↑</div>
            <div class="control-btn" id="shoot-btn">X</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // متغيرات اللعبة
        let score = 0, level = 1, gameActive = true;
        const keys = {};
        const themes = ['#00f7ff', '#f700ff', '#00ff44', '#ffff00', '#ff5500'];
        let currentTheme = themes[0];

        // الكائنات
        const player = { x: 50, y: 300, w: 30, h: 45, dy: 0, speed: 6, jump: -15, grounded: false };
        const boss = { active: false, x: 650, y: 100, size: 80, hp: 20, dy: 3 };
        let bullets = [], enemies = [], platforms = [], particles = [];

        // إنشاء المنصات
        function initPlatforms() {
            platforms = [
                { x: 100, y: 280, w: 150, h: 12, speed: 2, range: 100, startX: 100 },
                { x: 450, y: 220, w: 150, h: 12, speed: -2, range: 150, startX: 450 },
                { x: 250, y: 130, w: 150, h: 12, speed: 1.5, range: 200, startX: 250 }
            ];
        }
        initPlatforms();

        // التحكم باللمس
        const setupBtn = (id, key) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; if(key === 'shoot') fire(); });
            el.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
        };
        setupBtn('left-btn', 'left'); setupBtn('right-btn', 'right');
        setupBtn('jump-btn', 'jump'); setupBtn('shoot-btn', 'shoot');

        // التحكم بالكيبورد
        window.addEventListener('keydown', e => { 
            if(e.code === 'ArrowLeft') keys['left'] = true;
            if(e.code === 'ArrowRight') keys['right'] = true;
            if(e.code === 'Space' || e.code === 'ArrowUp') keys['jump'] = true;
            if(e.code === 'KeyX') fire();
        });
        window.addEventListener('keyup', e => {
            if(e.code === 'ArrowLeft') keys['left'] = false;
            if(e.code === 'ArrowRight') keys['right'] = false;
            if(e.code === 'Space' || e.code === 'ArrowUp') keys['jump'] = false;
        });

        function fire() {
            if(!gameActive) return;
            bullets.push({ x: player.x + player.w, y: player.y + 15, w: 15, h: 5, speed: 12 });
        }

        function createParticles(x, y, color) {
            for(let i=0; i<8; i++) {
                particles.push({ x, y, dx: (Math.random()-0.5)*8, dy: (Math.random()-0.5)*8, life: 20, color });
            }
        }

        function update() {
            if(!gameActive) return;

            // حركة اللاعب
            if(keys['left'] && player.x > 0) player.x -= player.speed;
            if(keys['right'] && player.x < canvas.width - player.w) player.x += player.speed;
            if(keys['jump'] && player.grounded) { player.dy = player.jump; player.grounded = false; }

            player.dy += 0.8; // جاذبية
            player.y += player.dy;

            // الأرضية والمنصات
            player.grounded = false;
            if(player.y + player.h > 380) { player.y = 380 - player.h; player.dy = 0; player.grounded = true; }
            
            platforms.forEach(p => {
                p.x += p.speed;
                if(Math.abs(p.x - p.startX) > p.range) p.speed *= -1;
                if(player.x + player.w > p.x && player.x < p.x + p.w && player.y + player.h > p.y && player.y + player.h < p.y + p.h + 10 && player.dy >= 0) {
                    player.y = p.y - player.h; player.dy = 0; player.grounded = true; player.x += p.speed;
                }
            });

            // الرصاص والوحوش
            bullets = bullets.filter(b => {
                b.x += b.speed;
                let hit = false;
                enemies.forEach((en, i) => {
                    if(b.x < en.x + en.s && b.x + b.w > en.x && b.y < en.y + en.s && b.y + b.h > en.y) {
                        createParticles(en.x, en.y, '#ff0055');
                        enemies.splice(i, 1); score += 10; hit = true;
                    }
                });
                return !hit && b.x < canvas.width;
            });

            // ظهور الوحوش والزعيم
            if(!boss.active && Math.random() < 0.02) enemies.push({ x: canvas.width, y: 350, s: 25, speed: 3 + level });
            enemies.forEach((en, i) => {
                en.x -= en.speed;
                if(player.x < en.x + en.s && player.x + player.w > en.x && player.y < en.y + en.s && player.y + player.h > en.y) {
                    gameActive = false; alert("انتهت اللعبة! نقاطك: " + score); location.reload();
                }
                if(en.x < -30) enemies.splice(i, 1);
            });

            // نظام الزعيم
            if(score >= level * 200 && !boss.active) {
                boss.active = true; boss.hp = 15 + (level * 5);
                document.getElementById('boss-info').style.display = 'block';
            }

            if(boss.active) {
                boss.y += boss.dy;
                if(boss.y < 20 || boss.y > 250) boss.dy *= -1;
                document.getElementById('bossHealth').innerText = boss.hp;
                bullets.forEach((b, i) => {
                    if(b.x > boss.x && b.x < boss.x + boss.size && b.y > boss.y && b.y < boss.y + boss.size) {
                        boss.hp--; bullets.splice(i, 1);
                        if(boss.hp <= 0) {
                            boss.active = false; level++; score += 50;
                            document.getElementById('boss-info').style.display = 'none';
                            currentTheme = themes[level % themes.length];
                        }
                    }
                });
            }

            particles.forEach((p, i) => { p.x += p.dx; p.y += p.dy; p.life--; if(p.life <= 0) particles.splice(i, 1); });
            document.getElementById('score').innerText = score;
            document.getElementById('level').innerText = level;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // رسم الأرضية
            ctx.strokeStyle = currentTheme; ctx.lineWidth = 3;
            ctx.strokeRect(-5, 380, canvas.width + 10, 50);

            // رسم المنصات
            platforms.forEach(p => {
                ctx.fillStyle = currentTheme + "33";
                ctx.fillRect(p.x, p.y, p.w, p.h);
                ctx.strokeStyle = currentTheme; ctx.strokeRect(p.x, p.y, p.w, p.h);
            });

            // رسم اللاعب
            ctx.shadowBlur = 10; ctx.shadowColor = currentTheme;
            ctx.strokeStyle = "white"; ctx.strokeRect(player.x, player.y, player.w, player.h);
            ctx.strokeRect(player.x + 10, player.y + 10, 10, 10); // عين البطل

            // رسم الوحوش
            ctx.shadowColor = "red";
            enemies.forEach(en => { ctx.fillStyle = "red"; ctx.fillRect(en.x, en.y, en.s, en.s); });

            // رسم الرصاص والجسيمات
            ctx.shadowBlur = 5; bullets.forEach(b => { ctx.fillStyle = "white"; ctx.fillRect(b.x, b.y, b.w, b.h); });
            particles.forEach(p => { ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, 4, 4); });

            // رسم الزعيم
            if(boss.active) {
                ctx.shadowBlur = 20; ctx.shadowColor = currentTheme;
                ctx.strokeStyle = currentTheme; ctx.strokeRect(boss.x, boss.y, boss.size, boss.size);
                ctx.strokeRect(boss.x + 20, boss.y + 20, 40, 40);
            }
        }

        function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }
        gameLoop();
    </script>
</body>
</html>